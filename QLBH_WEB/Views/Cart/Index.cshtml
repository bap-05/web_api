@model QLBH_WEB.Models.Cart

@{
    ViewBag.Title = "Giỏ hàng";
}

@section Styles {
    <link href="@Url.Content("~/Content/css_main/Cart.css")" rel="stylesheet" type="text/css" />
}

<div class="cart-page-wrapper">
    <div class="center_title_bar">Giỏ hàng của bạn</div>

    @* Kiểm tra xem giỏ hàng có rỗng không *@
    @if (Model == null || !Model.Items.Any())
    {
        <p style="padding: 20px;">Giỏ hàng của bạn đang trống.</p>
        <div class="cart-actions">
            @Html.ActionLink("Tiếp tục mua sắm", "Index", "Home", null, new { @class = "btn-cart btn-continue" })
        </div>
    }
    else
    {
        using (Html.BeginForm("UpdateCart", "Cart", FormMethod.Post))
        {
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>Hình ảnh</th>
                        <th>Tên sản phẩm</th>
                        <th>Đơn giá</th>
                        <th>Số lượng</th>
                        <th>Thành tiền</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @* Sửa lại: Vòng lặp sẽ duyệt qua các giá trị trong Dictionary Items *@
                    @foreach (var item in Model.Items.Values)
                    {
                        <tr>
                            <td>
                                <img src="@Url.Content("~/Content/images/" + (item.SanPham.HINHANH ?? "no-image.png"))"
                                     alt="@item.SanPham.TENSANPHAM" class="cart-product-image" />
                            </td>
                            <td>@item.SanPham.TENSANPHAM</td>
                            <td>@string.Format("{0:N0} $", item.SanPham.DONGIA)</td>
                            <td>
                                @* Thêm name để controller có thể đọc được khi update *@
                                <input type="number" name="quantity_@item.SanPham.MASANPHAM" value="@item.SoLuong" min="0" style="width: 60px;" />
                            </td>
                            <td>@string.Format("{0:N0} $", item.ThanhTien)</td>
                            <td>
                                @Html.ActionLink("Xóa", "RemoveFromCart", new { id = item.SanPham.MASANPHAM }, new { @class = "btn-cart btn-delete" })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="cart-total-section">
                <h4>Tổng cộng</h4>
                @* Sửa lại: Gọi trực tiếp phương thức GetTotal() từ Model *@
                <p class="grand-total">@string.Format("{0:N0} $", Model.GetTotal())</p>
            </div>

            <div class="cart-actions">
                @* Sửa lại: Link quay về trang chủ Home an toàn hơn *@
                @Html.ActionLink("Quay lại trang chủ", "Index", "Home", null, new { @class = "btn-cart btn-continue" })
                <button type="submit" class="btn-cart btn-update">Cập nhật</button>
                <a href="#" class="btn-cart btn-checkout">Thanh toán</a>
            </div>
        }
    }
</div>